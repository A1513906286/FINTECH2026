# 代理配置说明

## 📋 概述

阿布扎比推荐功能使用DuckDuckGo API进行搜索。如果你的网络环境无法直接访问DuckDuckGo，可以通过代理（如Clash）来解决。

---

## 🌐 方案1: 使用代理（推荐）

### 1. 安装Clash

下载并安装Clash for Windows:
- 官网: https://github.com/Fndroid/clash_for_windows_pkg/releases
- 下载最新版本的 `Clash.for.Windows.Setup.exe`

### 2. 配置Clash

1. 打开Clash
2. 导入订阅链接（从你的VPN服务商获取）
3. 启动Clash
4. 确保代理端口为 **7890**（默认）

### 3. 验证代理

在浏览器中访问: https://api.duckduckgo.com/?q=test&format=json

如果能看到JSON数据，说明代理工作正常。

### 4. 启用代理（默认已启用）

在 `app.py` 第28-37行：

```python
abu_dhabi_service = AbuDhabiService(
    model_name="llama3.2:3b",
    use_proxy=True,  # ✅ 已启用代理
    proxy_url="http://127.0.0.1:7890"  # Clash默认端口
)
```

### 5. 启动项目

```powershell
python app.py
```

应该看到：
```
🌐 已启用代理: http://127.0.0.1:7890
✅ Ollama客户端初始化成功，模型: llama3.2:3b
```

---

## 🔧 方案2: 不使用代理（直连）

如果你的网络环境可以直接访问DuckDuckGo，可以禁用代理。

### 修改配置

在 `app.py` 第28-37行：

```python
abu_dhabi_service = AbuDhabiService(
    model_name="llama3.2:3b",
    use_proxy=False,  # ❌ 禁用代理
)
```

### 启动项目

```powershell
python app.py
```

应该看到：
```
🌐 未使用代理
✅ Ollama客户端初始化成功，模型: llama3.2:3b
```

---

## ⚙️ 自定义代理端口

如果你的代理端口不是7890，可以修改：

```python
abu_dhabi_service = AbuDhabiService(
    model_name="llama3.2:3b",
    use_proxy=True,
    proxy_url="http://127.0.0.1:你的端口"  # 例如: 7891
)
```

---

## 🔍 常见问题

### Q1: 如何查看Clash代理端口？

1. 打开Clash
2. 点击 "General" 或"常规"
3. 查看 "Port" 或"端口"（通常是7890）

### Q2: 代理不工作怎么办？

**检查步骤**:
1. 确保Clash正在运行
2. 确保Clash已启动代理（System Proxy开启）
3. 在浏览器测试: https://api.duckduckgo.com/?q=test&format=json
4. 检查代理端口是否正确

### Q3: 出现 "ProxyError" 错误

**原因**: Clash未运行或端口错误

**解决**:
1. 启动Clash
2. 或者禁用代理: `use_proxy=False`

### Q4: 出现 "Connection timeout" 错误

**原因**: 网络连接超时

**解决**:
1. 检查网络连接
2. 尝试更换Clash节点
3. 增加超时时间（在 `services/abu_dhabi_service.py` 中修改 `timeout=10` 为更大值）

---

## 📊 代理 vs 直连对比

| 特性 | 使用代理 | 直连 |
|------|---------|------|
| 访问速度 | ⚠️ 取决于代理速度 | ✅ 快 |
| 稳定性 | ⚠️ 取决于代理稳定性 | ✅ 稳定 |
| 适用场景 | 🇨🇳 国内网络环境 | 🌍 国外网络环境 |
| 配置难度 | ⚠️ 需要安装Clash | ✅ 无需配置 |

---

## 🎯 推荐配置

- **国内用户**: `use_proxy=True` + Clash
- **国外用户**: `use_proxy=False`
- **测试环境**: 先尝试 `use_proxy=False`，如果失败再启用代理

---

## 📝 技术细节

### 代理实现

```python
# 在 services/abu_dhabi_service.py 中
proxies = {
    "http": "http://127.0.0.1:7890",
    "https": "http://127.0.0.1:7890"
}

response = requests.get(url, proxies=proxies, timeout=10)
```

### 支持的代理类型

- ✅ HTTP代理
- ✅ HTTPS代理
- ✅ SOCKS5代理（需要安装 `requests[socks]`）

---

## 🚀 快速测试

### 测试代理连接

```python
import requests

proxies = {
    "http": "http://127.0.0.1:7890",
    "https": "http://127.0.0.1:7890"
}

try:
    response = requests.get(
        "https://api.duckduckgo.com/?q=test&format=json",
        proxies=proxies,
        timeout=10
    )
    print("✅ 代理连接成功")
    print(response.json())
except Exception as e:
    print(f"❌ 代理连接失败: {e}")
```

---

**如有问题，请查看控制台日志或联系开发者。** 🎉

